function resourceCallBack(){cc.game.onStart=function(){cc.view.adjustViewPort(!0),thisismobile?cc.view.setDesignResolutionSize(480,800,cc.ResolutionPolicy.SHOW_ALL):cc.view.setDesignResolutionSize(480,800,cc.ResolutionPolicy.SHOW_ALL),cc.view.resizeWithBrowserSize(!0),MyLoaderScene.preload(g_resources,function(){cc.director.runScene(new StartScene)},this)},cc.game.run("gameCanvas")}var CheckpointLayer=cc.Layer.extend({themeIndex:null,checkpointFlags:null,initWidthThemeIndex:function(a){this.init(),this.themeIndex=a;var b=cc.Sprite.create(res.background),c=cc.p(WinSize.width/2,WinSize.height/2);b.setPosition(c),this.addChild(b);var d=cc.LabelBMFont.create("第"+ChineseNumber[a-1]+"季",res.font_fnt);d.attr({x:c.x,y:WinSize.height-30,scale:1.5}),this.addChild(d);var e=LocalStorageUtil.getInstance();this.checkpointFlags=e.getCheckpointByThemeIndex(a-1).checkpoints;var f=cc.Menu.create(this.createMenuItems(-155,300));f.setPosition(c),this.addChild(f);var g=cc.MenuItemSprite.create(cc.Sprite.create("#btnBack.png"),cc.Sprite.create("#btnBackPress.png"),null,this.backThemeScene,this);g.setScale(.4);var h=cc.Menu.create(g);h.attr({x:WinSize.width-40,y:80}),this.addChild(h)},createMenuItems:function(a,b){for(var c=[],d=0;d<8;d++)for(var e=0;e<5;e++){var f=cc.Sprite.create(this.checkCheckpoints(this.checkpointFlags[5*d+e].islock)),g=cc.LabelBMFont.create(5*d+e+1,res.font_fnt);g.attr({x:f.width/2,y:f.height/2,scale:2}),f.addChild(g);var h=cc.MenuItemSprite.create(f,null,null,this.startGameScene(5*d+e+1),this);h.attr({x:a+80*e,y:b-70*d,scale:.6}),c.push(h)}return c},startGameScene:function(a){var b=this;return function(){if(cc.log('_this.checkpointFlags[checkpointIndex-1]["islock"]：'+(a-1)),b.checkpointFlags[a-1].islock===!1){var c=GameScene.createWithThemeAndCheckpoint(b.themeIndex,a);0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(c)}}},backThemeScene:function(){0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(new ThemeScene)},checkCheckpoints:function(a){return a===!1?"#optionBg.png":"#optionBgLocked.png"}}),CheckpointScene=cc.Scene.extend({initWithThemeIndex:function(a){this.init();var b=new CheckpointLayer;b.initWidthThemeIndex(a),this.addChild(b)}});CheckpointScene.createWithThemeIndex=function(a){var b=new CheckpointScene;return b.initWithThemeIndex(a),b};var g_sharedGameLayer,GameLayer=cc.Layer.extend({soundSprite:null,gameAnimationLayer:null,waterDrop_array:null,waterBomb_array:null,waterMark_array:null,waterMark_number:null,themeIndex:null,checkpointIndex:null,stateMenu:null,init:function(){if(this._super()){cc.spriteFrameCache.addSpriteFrames(res.waterdrops_plist);var a=cc.p(WinSize.width/2,WinSize.height/2),b=cc.Layer.create(),c=cc.Sprite.create(res.game_bg);c.setPosition(a),b.addChild(c);var d=cc.Sprite.create(res.grid);d.attr({x:a.x,y:a.y+30}),b.addChild(d),this.addChild(b);var e=cc.Layer.create(),f=cc.MenuItemSprite.create(cc.Sprite.create("#btnBack.png"),cc.Sprite.create("#btnBackPress.png"),null,this.backCheckpointScene,this);f.setScale(.4),f.attr({x:180,y:-320}),0===VOICE_STATE?this.soundSprite=cc.Sprite.create("#btnvoiceon.png"):this.soundSprite=cc.Sprite.create("#btnvoiceoff.png"),this.soundSprite.setScale(.5);var g=cc.MenuItemSprite.create(this.soundSprite,null,null,this.settingsSound,this);g.attr({x:20,y:330});var h=cc.MenuItemSprite.create(cc.Sprite.create("#refresh.png"),null,null,this.reStartGame,this);return h.attr({x:200,y:310}),this.stateMenu=cc.Menu.create([f,g,h]),e.addChild(this.stateMenu),this.addChild(e),!0}},parseCheckpointConfig:function(a,b,c){var d=this;cc.loader.loadJson(root_path+"/Theme"+a+"/checkpoint"+b+".json",function(a,b){return a?cc.log("load failed"):void c(b,d)})},initWithThemeAndCheckpoint:function(a,b){this.waterDrop_array=[],this.waterBomb_array=[],this.waterMark_array=[],this.gameAnimationLayer=cc.Layer.create(),this.gameAnimationLayer.tag=LAYER_TAG.game_animation,this.themeIndex=a,this.checkpointIndex=b,this.parseCheckpointConfig(a,b,this.createWaterDrop);var c=cc.LabelBMFont.create("第 "+b+" 关",res.font_fnt);c.attr({x:60,y:WinSize.height-90,scale:1.3}),this.gameAnimationLayer.addChild(c);var d=cc.LabelBMFont.create("水滴数",res.font_fnt);d.attr({x:60,y:150,scale:1.3}),this.gameAnimationLayer.addChild(d),this.addChild(this.gameAnimationLayer),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchMoved:null,onTouchEnded:null},this),g_sharedGameLayer=this,this.schedule(this.checkGameSuccess,FRAME_RATE.check_gameover)},createWaterDrop:function(a,b){b.waterMark_number=a.water_number;for(var c=0;c<b.waterMark_number;c++){var d=cc.Sprite.create("#onlyOneDrop_28.png");d.attr({x:135+45*c,y:150}),b.waterMark_array.push(d),b.gameAnimationLayer.addChild(d)}for(var e=a.water_state,c=0;c<6;c++)for(var f=0;f<6;f++){var g=e[6*c+f];if(0!=g){var h=WaterDropSprite.createWithState(g);h.attr({x:35+82*f,y:640-84*c}),h.tag=6*c+f,b.gameAnimationLayer.addChild(h),b.waterDrop_array.push(h)}else b.waterDrop_array.push(null)}},settingsSound:function(){0===VOICE_STATE?(this.soundSprite.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame("btnvoiceoff.png")),VOICE_STATE=1):(this.soundSprite.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame("btnvoiceon.png")),cc.audioEngine.playEffect(res.voice_press),VOICE_STATE=0)},onTouchBegan:function(a,b){for(var c=b.getCurrentTarget(),d=c.waterBomb_array.length;d--&&c.waterBomb_array[d].is_exit!==!0;);if(d===-1){c.waterBomb_array=[];for(var e=0;e<c.waterDrop_array.length;e++){var f=c.waterDrop_array[e];if(null!=f){var g=cc.rect(f.x-f.width/2,f.y-f.height/2,f.width,f.height);if(cc.rectContainsPoint(g,a.getLocation())){var h=f.getActionByTag(ACTION_TAG.water_break);(null===h||h&&h.isDone())&&(--c.waterMark_number>=0?(c.waterMark_array[c.waterMark_number].removeFromParent(),0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_hit_water),4===f.state?(g_sharedGameLayer.waterDrop_array[e]=null,f.breakWaterDrop()):f.expandWaterDrop()):c.showFailureMenu());break}}}}return!0},backCheckpointScene:function(){var a=CheckpointScene.createWithThemeIndex(this.themeIndex);0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(a)},showFailureMenu:function(){this.stateMenu.setEnabled(!1);var a=cc.Layer.create(),b=cc.Sprite.create(res.successWindow);b.attr({x:WinSize.width/2,y:WinSize.height/2,scaleY:.8}),a.addChild(b);var c=cc.LabelBMFont.create("已经没有水滴了, 就差一点点。",res.font_fnt);c.attr({x:WinSize.width/2+10,y:WinSize.height/2+30,scaleY:1.3}),a.addChild(c);var d=cc.LabelBMFont.create("继续努力 !",res.font_fnt);d.attr({x:WinSize.width/2,y:WinSize.height/2-15,scaleY:1.3}),a.addChild(d);var e=cc.MenuItemSprite.create(cc.Sprite.create("#restartButton.png"),null,null,this.reStartGame,this),f=cc.Menu.create([e]);f.attr({x:WinSize.width/2,y:WinSize.height/2-80}),a.addChild(f),a.tag=LAYER_TAG.game_failure,this.addChild(a)},reStartGame:function(){0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),this.initWithThemeAndCheckpoint(this.themeIndex,this.checkpointIndex),null!=this.getChildByTag(LAYER_TAG.game_failure)&&this.removeChildByTag(LAYER_TAG.game_failure),null!=this.getChildByTag(LAYER_TAG.game_success)&&this.removeChildByTag(LAYER_TAG.game_success),this.removeChildByTag(LAYER_TAG.game_animation),this.stateMenu.setEnabled(!0)},checkGameSuccess:function(){for(var a=this.waterDrop_array.length;a--&&null==this.waterDrop_array[a];);var b=this.waterBomb_array.length;if(b>0)for(;b--&&this.waterBomb_array[b].is_exit!==!0;);a===-1&&b===-1&&(this.unscheduleAllCallbacks(),this.showSuccessMenu())},showSuccessMenu:function(){this.stateMenu.setEnabled(!1);var a=cc.Layer.create(),b=cc.Sprite.create(res.successWindow);b.attr({x:WinSize.width/2,y:WinSize.height/2,scaleY:.8}),a.addChild(b);var c=this.waterMark_array.length-this.waterMark_number,d=cc.LabelBMFont.create("恭喜您过关了, 只用了"+c+"滴水。",res.font_fnt);d.attr({x:WinSize.width/2+10,y:WinSize.height/2+30,scaleY:1.3}),a.addChild(d);var e=cc.MenuItemSprite.create(cc.Sprite.create("#shareScore.png"),null,null,this.shareScore,this);e.setScale(.8);var f=cc.MenuItemSprite.create(cc.Sprite.create("#nextLevelButton.png"),null,null,this.beginNextGame,this);f.setScale(.8);var g=cc.Menu.create([e,f]);g.attr({x:WinSize.width/2,y:WinSize.height/2-80}),g.alignItemsHorizontallyWithPadding(10),a.addChild(g),a.tag=LAYER_TAG.game_success,this.addChild(a)},beginNextGame:function(){var a=GameScene.createWithThemeAndCheckpoint(this.themeIndex,this.checkpointIndex+1);0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(a)},shareScore:function(){for(var a=LocalStorageUtil.getInstance(),b=a.getCheckpointByThemeIndex(this.themeIndex-1).checkpoints,c=b.length;c--;)if(b[c].islock===!1){var d={imgUrl:"http://m.koudaiwan.cn/game/20140804/shuibogongjizhan/logo/icon.png",timeLineLink:"http://m.koudaiwan.cn/yly/indexforwx.y",tTitle:"水波攻击战",tContent:"我已经玩到水波攻击战的第"+(c+1)+"关了, 而且只用了"+(this.waterMark_array.length-this.waterMark_number)+"滴水, 是不是太水了..., 快来挑战我吧!"};dp_submitScore(0,0,d);break}}}),GameScene=cc.Scene.extend({initWithThemeAndCheckpoint:function(a,b){this.init();var c=new GameLayer;c.init(),c.initWithThemeAndCheckpoint(a,b),this.addChild(c)}});GameScene.createWithThemeAndCheckpoint=function(a,b){var c=new GameScene,d=LocalStorageUtil.getInstance();return d.setLastThemeCheckpoint(a-1,b-1),c.initWithThemeAndCheckpoint(a,b),c};var LocalStorageUtil=function(){this.init()};LocalStorageUtil.prototype={themesKey:"THEMES",init:function(){if(localStorage){var a,b=localStorage.getItem(this.themesKey);return b||(a=this.initThemeObjs(),localStorage.setItem(this.themesKey,JSON.stringify(a))),a||(a=JSON.parse(b)),a}},initThemeObjs:function(){for(var a=[],b=0;b<6;b++)0===b?a.push({islock:!1,checkpoints:this.initCheckpointObjs()}):a.push({islock:!0,checkpoints:this.initCheckpointObjs()});return a},initCheckpointObjs:function(){for(var a=[],b=0;b<40;b++)0===b?a.push({islock:!1}):a.push({islock:!0});return a},getThemes:function(){if(localStorage){var a=localStorage.getItem(this.themesKey);if(a){for(var b=JSON.parse(a),c=[],d=0;d<b.length;d++){var e=b[d];c.push(e.islock)}return c}return[!1]}},getCheckpointByThemeIndex:function(a){if(localStorage){var b=localStorage.getItem(this.themesKey);if(b){var c=JSON.parse(b);return c[a]}return null}},setLastThemeCheckpoint:function(a,b){if(localStorage){var c=JSON.parse(localStorage.getItem(this.themesKey)),d=c[a].checkpoints;d[b].islock=!1,b<=38&&(c[a].checkpoints=d),39===b&&(c[a+1].islock=!1,c[a].checkpoints=d),localStorage.setItem(this.themesKey,JSON.stringify(c))}}};var localStorageUtil;LocalStorageUtil.getInstance=function(){return localStorageUtil||(localStorageUtil=new LocalStorageUtil),localStorageUtil};var MyLoaderScene=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"MyLoaderScene",init:function(){var a=this,b=a._bgLayer=cc.LayerColor.create(cc.color(32,32,32,255));b.setPosition(cc.visibleRect.bottomLeft),a.addChild(b,0);var c=cc.director.getWinSize(),d=cc.Sprite.create(res.loadingpage);d.setPosition(c.width/2,c.height/2),d.setScale(1),b.addChild(d,0);var e=a._label=cc.LabelTTF.create("Loading... 0%","Arial",24);return e.setPosition(c.width/2,c.height/2-200),e.setColor(cc.color(255,255,255)),b.addChild(this._label,10),!0},_initStage:function(a,b){var c=this,d=c._texture2d=new cc.Texture2D;d.initWithElement(a),d.handleLoadedTexture();var e=c._logo=cc.Sprite.create(d);e.setScale(cc.contentScaleFactor()),e.x=b.x,e.y=b.y,c._bgLayer.addChild(e,10)},onEnter:function(){var a=this;cc.Node.prototype.onEnter.call(a),a.schedule(a._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var a="Loading... 100%";this._label.setString(a)},initWithResources:function(a,b){"string"==typeof a&&(a=[a]),this.resources=a||[],this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);var b=a.resources;cc.loader.load(b,function(b,c,d){var e=d/c*100|0;e=Math.min(e,100),a._label.setString("Loading... "+e+"%")},function(){a.cb&&a.cb()})},_updatePercent:function(){var a=this,b=a._count,c=a._length,d=b/c*100|0;d=Math.min(d,100),a._label.setString("Loading... "+d+"%"),b>=c&&a.unschedule(a._updatePercent)}});MyLoaderScene.preload=function(a,b){var c=null;return c||(c=new MyLoaderScene,c.init()),c.initWithResources(a,b),cc.director.runScene(c),c};var thisismobile=!1;thisismobile=!(!/AppleWebKit.*Mobile/i.test(navigator.userAgent)&&!/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent));var size=size||{};size.width=512,size.height=1024;var ChineseNumber=["一","二","三","四","五","六"];if("undefined"==typeof FRAME_RATE){var FRAME_RATE={};FRAME_RATE.waterDrop_shake=.1,FRAME_RATE.waterDrop_break=.1,FRAME_RATE.waterBomb_move=.05,FRAME_RATE.waterBomb_hitWall=.05,FRAME_RATE.check_gameover=1}if("undefined"==typeof LAYER_TAG){var LAYER_TAG={};LAYER_TAG.game_animation=0,LAYER_TAG.game_failure=1,LAYER_TAG.game_success=2,LAYER_TAG.game_state=3}if("undefined"==typeof ACTION_TAG){var ACTION_TAG={};ACTION_TAG.water_break=0}var WinSize,VOICE_STATE=0,StartLayer=cc.Layer.extend({audioId:null,soundSprite:null,init:function(){if(this._super()){WinSize=cc.director.getWinSize();var a=cc.p(WinSize.width/2,WinSize.height/2);cc.spriteFrameCache.addSpriteFrames(res.images_plist,res.images_png);var b=cc.Sprite.create(res.background);b.setPosition(a),this.addChild(b);var c=cc.Sprite.create("#title.png");c.attr({x:a.x,y:a.y+150,scaleX:.8,scaleY:.8}),this.addChild(c);var d=cc.MenuItemSprite.create(cc.Sprite.create("#startButton.png"),null,null,this.startGame,this),e=cc.Menu.create([d]);e.attr({x:a.x,y:a.y-50}),this.addChild(e),0==VOICE_STATE?this.soundSprite=cc.Sprite.create("#btnvoiceon.png"):this.soundSprite=cc.Sprite.create("#btnvoiceoff.png");var f=cc.MenuItemSprite.create(this.soundSprite,null,null,this.settingsSound,this),g=cc.Menu.create([f]);return g.attr({x:WinSize.width-60,y:100}),this.addChild(g),!0}},startGame:function(){0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(new ThemeScene)},settingsSound:function(){0===VOICE_STATE?(this.soundSprite.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame("btnvoiceoff.png")),VOICE_STATE=1):(this.soundSprite.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame("btnvoiceon.png")),cc.audioEngine.playEffect(res.voice_press),VOICE_STATE=0)}});StartLayer.create=function(){var a=new StartLayer;return a&&a.init()?a:null};var StartScene=cc.Scene.extend({onEnter:function(){this._super();var a=new StartLayer.create;this.addChild(a)}}),ThemeLayer=cc.Layer.extend({themeFlags:null,init:function(){if(this._super()){var a=cc.Sprite.create(res.background),b=cc.p(WinSize.width/2,WinSize.height/2);a.setPosition(b),this.addChild(a);var c=LocalStorageUtil.getInstance();this.themeFlags=c.getThemes();var d=cc.Menu.create(this.createMenuItems(-120,150));d.setPosition(b),this.addChild(d);var e=cc.MenuItemSprite.create(cc.Sprite.create("#btnBack.png"),cc.Sprite.create("#btnBackPress.png"),null,this.backStartScene,this);e.setScale(.4);var f=cc.Menu.create([e]);return f.attr({x:WinSize.width-40,y:80}),this.addChild(f),!0}},createMenuItems:function(a,b){for(var c=[],d=0;d<3;d++)for(var e=0;e<2;e++){var f=cc.Sprite.create(this.checkThemes(this.themeFlags[2*d+e])),g=cc.LabelBMFont.create("第"+ChineseNumber[2*d+e]+"季",res.font_fnt);g.attr({x:f.width/2,y:f.height/2,scale:.7}),f.addChild(g),f.setScale(1.5);var h=cc.MenuItemSprite.create(f,null,null,this.startCheckpointScene(2*d+e+1),this);h.attr({x:a+190*e,y:b-180*d}),c.push(h)}return c},backStartScene:function(){0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(new StartScene)},checkThemes:function(a){return a===!1?"#optionBg.png":"#optionBgLocked.png"},startCheckpointScene:function(a){var b=this;return function(){if(b.themeFlags[a-1]===!1){var c=CheckpointScene.createWithThemeIndex(a);0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_press),cc.director.runScene(c)}}}});ThemeLayer.create=function(){var a=new ThemeLayer;return a&&a.init()?a:null};var ThemeScene=cc.Scene.extend({onEnter:function(){this._super();var a=ThemeLayer.create();this.addChild(a)}}),WaterBombSprite=cc.Sprite.extend({waterDropRow:null,waterDropColumn:null,is_exit:!0,initWithDirector:function(a,b){if(this.init())switch(this.waterDropRow=parseInt(parseInt(b,10)/6,10),this.waterDropColumn=parseInt(parseInt(b,10)%6,10),a){case"l":this.initWithSpriteFrameName("left_60.png"),this.schedule(this.toLeftWall,FRAME_RATE.waterBomb_move);break;case"r":this.initWithSpriteFrameName("right_59.png"),this.schedule(this.toRightWall,FRAME_RATE.waterBomb_move);break;case"u":this.initWithSpriteFrameName("up_43.png"),this.schedule(this.toUpWall,FRAME_RATE.waterBomb_move);break;case"d":this.initWithSpriteFrameName("down_44.png"),this.schedule(this.toDownWall,FRAME_RATE.waterBomb_move)}},toLeftWall:function(){if(this.x<=10){this.unscheduleAllCallbacks(),this.x=10,0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_drop_break);var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("leftHitWall_42.png")),a.push(cc.spriteFrameCache.getSpriteFrame("leftHitWall_34.png")),a.push(cc.spriteFrameCache.getSpriteFrame("leftHitWall_27.png")),a.push(cc.spriteFrameCache.getSpriteFrame("leftHitWall_18.png"));var b=cc.Animation.create(a,FRAME_RATE.waterBomb_hitWall),c=this,d=cc.CallFunc.create(function(){c.is_exit=!1,c.removeFromParent()}),e=cc.Animate.create(b);this.runAction(cc.Sequence.create(e,d))}else{this.x=this.x-15;for(var f=this.waterDropColumn;--f>=0&&!this.checkWaterBombMotion(this.waterDropRow,f););}},toRightWall:function(){if(this.x>=470){this.unscheduleAllCallbacks(),this.x=470,0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_drop_break);var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("rightHitWall_41.png")),a.push(cc.spriteFrameCache.getSpriteFrame("rightHitWall_33.png")),a.push(cc.spriteFrameCache.getSpriteFrame("rightHitWall_26.png")),a.push(cc.spriteFrameCache.getSpriteFrame("rightHitWall_17.png"));var b=cc.Animation.create(a,FRAME_RATE.waterBomb_hitWall),c=this,d=cc.CallFunc.create(function(){c.is_exit=!1,c.removeFromParent()}),e=cc.Animate.create(b);this.runAction(cc.Sequence.create(e,d))}else{this.x=this.x+15;for(var f=this.waterDropColumn;++f<=5&&!this.checkWaterBombMotion(this.waterDropRow,f););}},toUpWall:function(){if(this.y>=670){this.unscheduleAllCallbacks(),this.y=670,0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_drop_break);var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("upHitWall_48.png")),a.push(cc.spriteFrameCache.getSpriteFrame("upHitWall_63.png")),a.push(cc.spriteFrameCache.getSpriteFrame("upHitWall_61.png")),a.push(cc.spriteFrameCache.getSpriteFrame("upHitWall_54.png"));var b=cc.Animation.create(a,FRAME_RATE.waterBomb_hitWall),c=this,d=cc.CallFunc.create(function(){c.is_exit=!1,c.removeFromParent()}),e=cc.Animate.create(b);this.runAction(cc.Sequence.create(e,d))}else{this.y=this.y+15;for(var f=this.waterDropRow;--f>=0&&!this.checkWaterBombMotion(f,this.waterDropColumn););}},toDownWall:function(){if(this.y<=190){this.unscheduleAllCallbacks(),this.y=190,0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_drop_break);var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("downHitWall_49.png")),a.push(cc.spriteFrameCache.getSpriteFrame("downHitWall_64.png")),a.push(cc.spriteFrameCache.getSpriteFrame("downHitWall_62.png")),a.push(cc.spriteFrameCache.getSpriteFrame("downHitWall_55.png"));var b=cc.Animation.create(a,FRAME_RATE.waterBomb_hitWall),c=this,d=cc.CallFunc.create(function(){c.is_exit=!1,c.removeFromParent()}),e=cc.Animate.create(b);this.runAction(cc.Sequence.create(e,d))}else{this.y=this.y-15;for(var f=this.waterDropRow;++f<=5&&!this.checkWaterBombMotion(f,this.waterDropColumn););}},checkWaterBombMotion:function(a,b){var c=g_sharedGameLayer.waterDrop_array[6*a+b];if(null!=c){var d=cc.rect(c.x-c.width/2,c.y-c.height/2,c.width,c.height);return cc.rectContainsPoint(d,this.getPosition())&&(this.is_exit=!1,this.unscheduleAllCallbacks(),this.removeFromParent(),4!=c.state?c.expandWaterDrop():(g_sharedGameLayer.waterDrop_array[6*a+b]=null,c.breakWaterDrop())),!0}}});WaterBombSprite.initWithDirector=function(a,b){var c=new WaterBombSprite;return c.initWithDirector(a,b),c};var WaterDropSprite=cc.Sprite.extend({state:null,initWithState:function(a){if(this.init())switch(this.state=a,a){case 1:this.initWithSpriteFrameName("oneDrop_58.png"),this.oneDropShake();break;case 2:this.initWithSpriteFrameName("twoDrop_40.png"),this.twoDropShake();break;case 3:this.initWithSpriteFrameName("threeDrop_25.png"),this.threeDropShake();break;case 4:this.initWithSpriteFrameName("fourDrop_16.png"),this.fourDropShake()}},oneDropShake:function(){var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_52.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_51.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_50.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_47.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_58.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_57.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_56.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_46.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_45.png")),a.push(cc.spriteFrameCache.getSpriteFrame("oneDrop_53.png"));var b=cc.Animation.create(a,FRAME_RATE.waterDrop_shake),c=cc.Animate.create(b);this.runAction(cc.RepeatForever.create(c))},twoDropShake:function(){var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_36.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_35.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_32.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_31.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_40.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_39.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_38.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_30.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_29.png")),a.push(cc.spriteFrameCache.getSpriteFrame("twoDrop_37.png"));var b=cc.Animation.create(a,FRAME_RATE.waterDrop_shake),c=cc.Animate.create(b);this.runAction(cc.RepeatForever.create(c))},threeDropShake:function(){var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_25.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_24.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_23.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_22.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_14.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_13.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_21.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_20.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_19.png")),a.push(cc.spriteFrameCache.getSpriteFrame("threeDrop_15.png"));var b=cc.Animation.create(a,FRAME_RATE.waterDrop_shake),c=cc.Animate.create(b);this.runAction(cc.RepeatForever.create(c))},fourDropShake:function(){var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_16.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_12.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_11.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_10.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_5.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_4.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_9.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_8.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_7.png")),a.push(cc.spriteFrameCache.getSpriteFrame("fourDrop_6.png"));var b=cc.Animation.create(a,FRAME_RATE.waterDrop_shake),c=cc.Animate.create(b);this.runAction(cc.RepeatForever.create(c))},expandWaterDrop:function(){switch(this.stopAllActions(),0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_hit_water),this.state){case 1:this.twoDropShake(),this.state++;break;case 2:this.threeDropShake(),this.state++;break;case 3:this.fourDropShake(),this.state++}},breakWaterDrop:function(){0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_hit_water);var a=[];a.push(cc.spriteFrameCache.getSpriteFrame("touchBreak_2.png")),a.push(cc.spriteFrameCache.getSpriteFrame("touchBreak_0.png")),a.push(cc.spriteFrameCache.getSpriteFrame("touchBreak_1.png")),a.push(cc.spriteFrameCache.getSpriteFrame("touchBreak_3.png"));var b=cc.Animation.create(a,FRAME_RATE.waterDrop_break),c=cc.Animate.create(b),d=this,e=cc.CallFunc.create(function(){d.createWaterBomb(),d.removeFromParent()});this.stopAllActions();var f=cc.Sequence.create([c,e]);f.tag=ACTION_TAG.water_break,this.runAction(f)},createWaterBomb:function(){0===VOICE_STATE&&cc.audioEngine.playEffect(res.voice_drop_break);var a=g_sharedGameLayer.getChildByTag(LAYER_TAG.game_animation),b=WaterBombSprite.initWithDirector("l",this.tag);b.attr({x:this.x-48,y:this.y}),g_sharedGameLayer.waterBomb_array.push(b),a.addChild(b);var c=WaterBombSprite.initWithDirector("r",this.tag);c.attr({x:this.x+48,y:this.y}),g_sharedGameLayer.waterBomb_array.push(c),a.addChild(c);var d=WaterBombSprite.initWithDirector("u",this.tag);d.attr({x:this.x,y:this.y+48}),g_sharedGameLayer.waterBomb_array.push(d),a.addChild(d);var e=WaterBombSprite.initWithDirector("d",this.tag);e.attr({x:this.x,y:this.y-48}),g_sharedGameLayer.waterBomb_array.push(e),a.addChild(e)}});WaterDropSprite.createWithState=function(a){var b=new WaterDropSprite;return b.initWithState(a),b};